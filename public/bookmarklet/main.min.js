(()=>{const e=e=>{const t=e.split("-")[1].trim();return new Date(t)};const t=()=>{r("DERIVED_CLASS_S_SSR_NEXT_WEEK").click()},n=864e13,r=(e,t="")=>{let n=document.getElementById(e);if(n)return n;for(const r of document.getElementsByTagName("iframe")){if(n=r.contentDocument.getElementById(e),n)return n;if(t){if(els=r.contentDocument.getElementsByTagName(t),0==els.length)return n;for(const t of els)if(t.id==e)return t}}return n},i=e=>{const t=performance.now();return new Promise(((r,i)=>{((r,i)=>{let o=n;const l=new MutationObserver((()=>{o=performance.now()})),c=e=>{const s=performance.now();if(o!=n&&s-o>2500)return console.log(`DOM settled after ${performance.now()-t}ms`),l.disconnect(),void r();if(performance.now()-e>1e4){if(o==n)return console.log("DOM was not mutated in 10000ms, continuing..."),l.disconnect(),void r();i("DOM not settled")}else requestAnimationFrame((()=>c(e)))};l.observe(document,{attributes:!0,childList:!0,subtree:!0});for(const e of document.getElementsByTagName("iframe"))l.observe(e,{attributes:!0,childList:!0,subtree:!0});e(),c(performance.now())})(r,i)}))},o=async e=>{const t=document.getElementsByTagName("ul")[2].children[e].children[1].firstElementChild;console.log("ABOUT TO CLICK"),await i((()=>{t.click(),console.log("Clicked")})),console.log("DOM DONE!")},l=e=>e.toISOString().match(/(\d)|([TZ])/g).join(""),c=e=>{let t=e.match(/(\d{1,2})/g),[n,r]=t.map((e=>Number(e)));return e.includes("PM")&&(n+=12),[n,r]},s=async()=>{if(!((e,t)=>{for(const n of t)if(!e.innerText.includes(n))return!1;return!0})(document.body,["Manage My Classes","View My Weekly Schedule"]))return alert("Navigate to Orion > UTD Student Center > Manage My Classes > View My Classes, then rerun to continue.");if(!confirm("Press OK to begin."))return;await o(0);const n=function(){const t=Array.from(document.getElementsByTagName("iframe")).map((e=>Array.from(e.contentDocument.getElementsByTagName("table")))).flat();console.log(t);const n=t.find((e=>"ACE_STDNT_ENRL_SSV2$0"==e.id)).firstElementChild.children;let r=new Date(0);for(const t of n){if(1===t.children.length)continue;const n=t.children;if(1===n.length)continue;const i=n[1];if(i&&0!==i.children){const t=i.firstElementChild;if(!t)continue;const[n,o]=t.firstElementChild.firstElementChild.children,l=Array.from(o.firstElementChild.firstElementChild.firstElementChild.children[2].children[1].firstElementChild.children[1].firstElementChild.firstElementChild.firstElementChild.firstElementChild.firstElementChild.children).slice(1);for(const t of l){const n=e(t.children[7].innerText);n>r&&(r=n)}}}return r}();console.log(n),await o(1);const s=(e=>{let t=0,n=new Date(r("win0divDERIVED_CLASS_S_DESCR100_2","div").firstElementChild.firstElementChild.firstElementChild.innerText.slice(-10).trim());for(;n<e;)t++,n.setDate(n.getDate()+7);return t})(n);r("DERIVED_CLASS_S_SSR_DISP_TITLE","input").click(),r("DERIVED_CLASS_S_SHOW_INSTR","input").click();const a=r("DERIVED_CLASS_S_SSR_REFRESH_CAL$38$","input");await i((()=>a.click()));let d="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:v2.jasonaa.me/bookmarklet";for(let e=0;e<s;e++){const e=r("trSSR_DUMMY_REC$0_row1").firstElementChild.firstElementChild.children[1].firstElementChild.children[2];for(let t=1;t<e.children.length;t++){const n=e.children[t];for(let r=1;r<n.children.length;r++){const i=new Date(`${e.firstElementChild.children[r].childNodes[2].textContent} 2022`);i.setHours(7);const o=n.children[r];if(0===o.children.length)continue;const s=o.firstElementChild;if("SPAN"!==s.tagName)continue;const a=s.childNodes;console.log(a);const C=new Date(i),[g,D]=c(a[6].textContent.substring(0,7).trim()),[S,_]=c(a[6].textContent.slice(-7).trim());console.log({startHour:g,startMinute:D,endHour:S,endMinute:_}),C.setHours(g,D);const N=new Date(i);N.setHours(S,_),console.log({beginning:i,timeSlot:t,startDateTime:C,endDateTime:N}),d+=(m=a[0].textContent,f=C,E=N,u=a[8].textContent,h=`${a[2].textContent} with ${a[12].textContent}`,`\nBEGIN:VEVENT\nSUMMARY:${m}\nDTSTART:${l(f)}Z\nDTEND:${l(E)}Z\nGEO:${u}\nDESCRIPTION:${h}\nEND:VEVENT`)}}await i(t)}var m,f,E,u,h;d+="\nEND:VCALENDAR";const C=document.createElement("a");C.setAttribute("href","data:text/calendar;charset=utf-8,"+encodeURIComponent(d)),C.setAttribute("download",`term_${(new Date).toISOString()}.ics`),C.click()};try{s()}catch(e){alert("An unexpected error occurred."),console.error(e)}})();